<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Hello World</title>
  </head>
    <script src="js/pixi.min.js"></script>
    <script type="text/javascript" src="js/jquery.min.js"></script>
<body>
  <script type="text/javascript">
    let type = "WebGL"
    if(!PIXI.utils.isWebGLSupported()){
      type = "canvas"
    }
    let Application = PIXI.Application,
            loader = PIXI.loader,
            resources = PIXI.loader.resources,
            Sprite = PIXI.Sprite;
    //Create a Pixi Application
    let app = new Application({width: 520, height: 520});
    app.renderer.autoResize = true;
    //Add the canvas that Pixi automatically created for you to the HTML document
    document.body.appendChild(app.view);
    
    function loadCompleted(){ console.log("All files loaded.");}

    loader.add(["img/stool.png", "img/chair.png", "img/easel.png",
                "img/hatrack.png", "img/lamp.png", "img/sofa.png"])
          .load(loadCompleted)

    let items = {1:"img/stool.png", 2:"img/chair.png", 3: "img/easel.png",
             4:"img/hatrack.png", 5:"img/lamp.png", 6: "img/sofa.png"};

    function setup(navimap, h, w) {
      for (var n in navimap["nodes"]){
        t = parseTuple(n);
        item = navimap["nodes"][n];
        if (item < 7){
          let itemt = new Sprite(resources[items[item]].texture);
          itemt.width = Math.round(520/w) - 10
          itemt.height = Math.round(520/h) - 10
          itemt.x = Math.round(520/w) * (t[0] - 1)
          itemt.y = Math.round(520/h) * (t[1] - 1)
          app.stage.addChild(itemt)
        }
      }
    }

    function parseTuple(t) {
      return JSON.parse(t.replace(/\(/g, "[").replace(/\)/g, "]"));
    }

    function randomMap() {
      var $form = $("#rmapform"),
      height = $form.find("input[name='h']").val(),
      width = $form.find("input[name='w']").val(),
      url = $form.attr("action");

      $.post(url, { h: height, w: width}, function(navimap, textStatus ) {
        setup(navimap, height, width);
      });
    function predict(){
      url = $form.attr("action");
      $.post("")
    }

      return false;
    }
  </script>

  <form action="/rmap" method="post" id="rmapform" onsubmit="return false">
    <label >Height:</label> <input type="text" name="h" id="h"><br>
    <label >Width:</label> <input type="text" name="w" id="w"><br>
    <input type="button" id="rmap_btn" value="Random Map" onclick="randomMap()">
  </form>

  <form action="/execute" method="post" onsubmit="return false">
    Instruction: <input type="text" name="instruction"><br>
    <input type="submit" id="execute_btn" value="Execute"onclick="predict()">
  </form>
</body>
</html>
